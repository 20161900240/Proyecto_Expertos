///-----------------------------------------------USUARIOS
var usuarios = [{
        nombre: "Pedro",
        apellido: "Martinez",
        ordenes: [{
                nombreProducto: "Producto 1",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            },
            {
                nombreProducto: "Producto 2",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            }
        ]
    },
    {
        nombre: "Juan",
        apellido: "Perez",
        ordenes: [{
                nombreProducto: "Producto 3",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            },
            {
                nombreProducto: "",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            }
        ]
    },
    {
        nombre: "Maria",
        apellido: "Rodriguez",
        ordenes: [{
                nombreProducto: "Producto 4",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            },
            {
                nombreProducto: "Producto 1",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            }
        ]
    }
];


///-----------------------------------------------CATEGORIAS
var categorias = [{
        nombreCategoria: "Farmacias",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#FADA53",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Restaurantes",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#F2ACAC",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Salud",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#D98E6E",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Café",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#9481C3",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Bebidas",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#F3AB85",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    }
];
// Indice Usuario
var indiceUsuario = 0;

//console.log ('Usuarios', usuarios);
//console.log ('Categorias', categorias);

//LocalStorage
var localStorage = window.localStorage;
//Guardar usuarios en LocalStorage al cargar pagina la primera vez
if (localStorage.getItem('usuarios') == null) {
    localStorage.setItem('usuarios', JSON.stringify(usuarios)); // de JSON a cadena
} else {
    usuarios = JSON.parse(localStorage.getItem('usuarios')); // de cadena a JSON
}
//Guardar categorias en LocalStorage al cargar pagina la primera vez
if (localStorage.getItem('categorias') == null) {
    localStorage.setItem('categorias', JSON.stringify(categorias)); // de JSON a cadena
} else {
    categorias = JSON.parse(localStorage.getItem('categorias')); // de cadena a JSON
}

//Generar select de usuarios
function selectUsuarios() {
    for (let i = 0; i < usuarios.length; i++) {
        document.getElementById('usuarioActual').innerHTML += `
            <option value="${i}">${usuarios[i].nombre} ${usuarios[i].apellido} &#xf0d7;</option>
        `;

    }
    generarInfoUsuario(indiceUsuario);
}
selectUsuarios();

//Generar categorias
function generarCategorias() {
    document.getElementById('categorias').innerHTML = '';
    for (let i = 0; i < categorias.length; i++) {
        document.getElementById('categorias').innerHTML += `
        <div class="col-12 col-sm-12 col-md-6 col-lg-4 col-xl-3 d-flex mb-3">
            <div id="card-${i}" class="card flex-fill" onclick="modalCategoria(${i})">
                <div class="icono">
                    <i class="${categorias[i].icono}"></i>
                </div>
                <div class="card-body">
                    <h5 class="card-title mb-0">${categorias[i].nombreCategoria}</h5>
                    <p class="card-text">${categorias[i].descripcion}</p>
                </div>
            </div>
        </div>
        `;
        document.getElementById("card-" + i).style.backgroundColor = categorias[i].color;
    }
}
generarCategorias();

//Cambiar usuario en select
function cambiarUsuario() {
    //console.log(document.getElementById('usuarioActual').value);
    indiceUsuario = parseInt(document.getElementById('usuarioActual').value);
    generarInfoUsuario(indiceUsuario);
}

//Informacion de usuario seleccionado
function generarInfoUsuario(indice) {
    document.getElementById('usuarioSeleccionado').innerHTML = `¡Hola ${usuarios[indice].nombre}!`;
    document.getElementById('modalOrdenesLabel').innerHTML = `${usuarios[indice].nombre}, Estas son tus ordenes`;
    document.getElementById('ordenesInfo').innerHTML = '';
    for (let i = 0; i < usuarios[indice].ordenes.length; i++) {
        document.getElementById('ordenesInfo').innerHTML += `
            <h2>${usuarios[indice].ordenes[i].nombreProducto}</h2>
            <p class="modal-descripcion">${usuarios[indice].ordenes[i].descripcion}</p>
            <p class="modal-price float-right">$${usuarios[indice].ordenes[i].precio}</p>
            <hr>
        `;
    }
}

//Modal Categoria
function modalCategoria(indice) {
    document.getElementById('modalCategoriaLabel').innerHTML = categorias[indice].nombreCategoria;
    document.getElementById('categoriaInfo').innerHTML = '';
    for (let i = 0; i < categorias[indice].empresas.length; i++) {
        let html_productos = '';
        //Recorremos productos por empresa
        for (let j = 0; j < categorias[indice].empresas[i].productos.length; j++) {
            if (j > 0) {
                html_productos += `<hr>`;
            }
            html_productos += `
                <button type="button" class="btn btn-purple float-md-right mb-sm-3" onclick="pedirProducto(${indice},${i},${j})">Pedir</button>
                <h3 class="card-product">${categorias[indice].empresas[i].productos[j].nombreProducto}</h3>
                <p class="modal-descripcion pt-2">${categorias[indice].empresas[i].productos[j].descripcion}</p>
                <p class="modal-price float-right">$${categorias[indice].empresas[i].productos[j].precio}</p>
            `;
        }
        document.getElementById('categoriaInfo').innerHTML += `
        <div class="col-12 col-sm-12 col-lg-6 mb-3">
            <div class="card">
                <div class="card-img">
                    <img src="${categorias[indice].empresas[i].imagen}" class="card-img-top" alt="">
                    <h1>${categorias[indice].empresas[i].nombreEmpresa}</h1>
                </div>
                <div class="card-body">
                    ${html_productos}
                </div>
            </div>
        </div>
        `;

    }
    $('#modalCategoria').modal('show');
}

function pedirProducto(indiceCategoria, indiceEmpresa, indiceProducto) {
    document.getElementById('productoInfo').innerHTML = `
        <h4 class="card-product">${categorias[indiceCategoria].empresas[indiceEmpresa].productos[indiceProducto].nombreProducto}</h4>
        <p class="modal-descripcion">${categorias[indiceCategoria].empresas[indiceEmpresa].productos[indiceProducto].descripcion}</p>
        <p class="modal-descripcion">Cantidad a solicitar:</p>
        <input id="input-cantidad" class="form-control w-50" type="text">
        <p class="modal-price float-right pt-4 mb-0">$${categorias[indiceCategoria].empresas[indiceEmpresa].productos[indiceProducto].precio}</p>
        <hr>
    `;
    document.getElementById('div-btn-procesar').innerHTML = `
    <button type="button" class="btn btn-purple" onclick="procesarOrden(${indiceCategoria},${indiceEmpresa},${indiceProducto})">Procesar Orden</button>
    `;
    $('#modalPedirProducto').modal('show');
}
//Validar campo vacio
function validarCampoVacio(id) {
    let campo = document.getElementById(id);
    if (campo.value == "") {
        campo.classList.add('input-error');
        return false;
    } else {
        campo.classList.remove('input-error');
    }
    return true;
}

function procesarOrden(indiceCategoria, indiceEmpresa, indiceProducto) {
    let cantidadProducto = parseInt(document.getElementById('input-cantidad').value);
    let input_lleno = validarCampoVacio('input-cantidad');
    const nueva_orden = {
        nombreProducto: categorias[indiceCategoria].empresas[indiceEmpresa].productos[indiceProducto].nombreProducto,
        descripcion: categorias[indiceCategoria].empresas[indiceEmpresa].productos[indiceProducto].descripcion,
        cantidad: cantidadProducto,
        precio: categorias[indiceCategoria].empresas[indiceEmpresa].productos[indiceProducto].precio
    }
    if (input_lleno && cantidadProducto >= 1) {
        usuarios[indiceUsuario].ordenes.push(nueva_orden);
        //Guardamos el cambio en LocalStorage
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        generarInfoUsuario(indiceUsuario);
        document.getElementById('input-cantidad').value = '';
        $('#modalPedirProducto').modal('hide');
    }
}

var desplegarForm = false;

function desplegarFormCategoria() {
    if (desplegarForm) {
        $('#formulario-categoria').fadeOut(500);
        desplegarForm = false;
    } else {
        $('#formulario-categoria').fadeIn(500);
        desplegarForm = true;
    }
}

function guardarCategoria() {
    const nueva_categoria = {
        nombreCategoria: document.getElementById('form-categoria').value,
        descripcion: document.getElementById('form-descripcion').value,
        color: document.getElementById('form-backgroundColor').value,
        icono: document.getElementById('form-icono').value,
        empresas: []
    }
    let campo1 = validarCampoVacio('form-categoria');
    let campo2 = validarCampoVacio('form-descripcion');
    let campo3 = validarCampoVacio('form-backgroundColor');
    let campo4 = validarCampoVacio('form-icono');
    if (campo1 && campo2 && campo3 && campo4) {
        categorias.push(nueva_categoria);
        //Guardamos el cambio en LocalStorage
        localStorage.setItem('categorias', JSON.stringify(categorias));
        generarCategorias();
    }
}