<nav class="navbar navbar-expand-md navbar-dark py-md-3 fixed-top" style="background-color: #563D7C;">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <h2 id="logo">Lugo</h2>
    </a>
    <button class="navbar-toggler" type="button" (click)="isMenuCollapsed = !isMenuCollapsed">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" [ngbCollapse]="isMenuCollapsed">
      <form class="form-inline my-2 my-lg-0 ml-auto">
        <select id="usuarioActual" class="form-control mr-3" (change)="cambiarUsuario()"
          [(ngModel)]="idUsuarioSeleccionado" [ngModelOptions]="{standalone: true}">
          <option *ngFor="let usuario of usuarios" [ngValue]="usuario._id">
            {{usuario.nombre}} {{usuario.apellido}}
          </option>
        </select>
        <button class="btn btn-secondary my-2 my-sm-0 mr-2" type="button" (click)="verOrdenes()">Ver Ordenes</button>
        <button type="button" class="btn btn-secondary my-2 my-sm-0" (click)="crearCategoria()">Agregar Nueva
          Categoria</button>
      </form>
    </div>
  </div>
</nav>

<main role="main" class="container" style="min-height: 100vh;">
  <div class="row mt-3 text-center mx-auto">
    <div class="col-lg-6 mx-auto">
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-lg-12 col-sm-12">
      <h2 id="texto-hola" *ngIf="usuarioActual != null">
        ¡Hola {{usuarioActual.nombre}}!
      </h2>
      <span id="texto-pregunta">
        ¿Que Necesitas?
      </span>
    </div>
  </div>
  <div id="contenedor-categorias" class="row mb-3">
    <!-- Categoría de ejemplo -->
    <div class="col-lg-3 col-md-4 col-sm-6 mt-2" *ngFor="let categoria of categorias">
      <div class="card-item card" [ngStyle]="{'background-color':categoria.color}" (click)="infoCategorias(categoria)">
        <div class="row">
          <div class="col mx-auto text-center m-3">
            <img src="{{categoria.icono}}" class="category-icon">
          </div>
          <div class="col"></div>
        </div>
        <div class="row m-3 mt-4">
          <section class="col">
            <h3 class="text-white font-weight-bolder">{{categoria.nombreCategoria}}</h3>
            <p class="text-white" style="font-size: 13px;">
              {{categoria.empresas.length}} Comercios
            </p>
          </section>
        </div>
      </div>
    </div>
    <!--  -->
  </div>
</main><!-- /.container -->
<br>
<footer style="height: 90px; background-color: #563D7C;" class="mt-5">

</footer>

<!-- Modal -->
<ng-template #modalCreacionCategoria let-modal>
  <div class="modal-header" style="background-color: #563D7C;">
    <h4 class="modal-title" id="modal-basic-title"></h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="formularioCategoria">
      <div class="form-group">
        <input [ngClass]="{'form-input-error':nombreCategoria.invalid && (nombreCategoria.dirty || nombreCategoria.touched)}" type="text"
          class="form-control" id="txt-nombre" formControlName="nombreCategoria" placeholder="Digite Nombre">
        <div *ngIf="nombreCategoria.invalid && (nombreCategoria.touched)" class="form-error">
          <span *ngIf="nombreCategoria.errors.required">Campo obligatorio</span>
        </div>
      </div>
      <div class="form-group">
        <input [ngClass]="{'form-input-error':descripcion.invalid && (descripcion.dirty || descripcion.touched)}"
          type="text" class="form-control" id="txt-descripcion" formControlName="descripcion"
          placeholder="Digite Descripcion">
        <div *ngIf="descripcion.invalid && (descripcion.touched)" class="form-error">
          <span *ngIf="descripcion.errors.required">Campo obligatorio</span>
        </div>
      </div>
      <div class="form-group">
        <input [ngClass]="{'form-input-error':color.invalid && (color.dirty || color.touched)}" type="text"
          class="form-control" id="txt-color" formControlName="color" placeholder="Digite Color Ej. #FF0000">
        <div *ngIf="color.invalid && (color.touched)" class="form-error">
          <span *ngIf="color.errors.required">Campo obligatorio</span>
          <span *ngIf="color.errors.pattern">Color inválido</span>
        </div>
      </div>
      <div class="form-group">
        <input [ngClass]="{'form-input-error':icono.invalid && (icono.dirty || icono.touched)}" type="text"
          class="form-control" id="txt-icono" formControlName="icono" placeholder="Digite Icono Ej. imagen.png">
        <div *ngIf="icono.invalid && (icono.touched)" class="form-error">
          <span *ngIf="icono.errors.required">Campo obligatorio</span>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button [disabled]="!formularioCategoria.valid" type="button" class="btn btn-outline-dark"
      (click)="guardarCategoria()">Guardar Categoria</button>
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('Cerrar')">Cerrar</button>
  </div>
</ng-template>

<!-- Modal -->
<ng-template #modalPedidos let-modal>
  <div class="modal-header" style="background-color: #563D7C;">
    <h4 class="modal-title" id="modal-basic-title"></h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div id="zona-pedidos" class="modal-body">
      <h3>{{productoDetalle.nombreProducto}}</h3><br>
      <p>{{productoDetalle.descripcion}}</p><br>
      <div class="row">
        <div class="col-lg-4">
          Cantidad A Solicitar :
        </div>
        <div class="col-lg-8">
          <input type="text" class="form-control" id="txt-cantidad" [(ngModel)]="cantidadProducto" />
          <div *ngIf="errorPedido" class="text-danger">
            <span *ngIf="idUsuarioSeleccionado == null">Error: Usuario no seleccionado</span>
            <span *ngIf="idUsuarioSeleccionado != null">Error: Dato inválido</span>
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-lg-10 mr-auto">

        </div>
        <div class="col-lg-2"><br>
          <b>$ {{productoDetalle.precio}}</b>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" (click)="agregarPedido()" class="btn btn-secondary">
      Procesar Orden</button>
  </div>
</ng-template>

<!-- Modal -->
<ng-template #modalCategorias let-modal>
  <div class="modal-header" style="background-color: #563D7C;">
    <h2 class="modal-title font-weight-bolder text-white">{{categoriaDetalle.nombreCategoria}}</h2>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div id="zona-categorias" class="modal-body row">
    <div class="col-lg-6 col-sm-12 mt-2" *ngFor="let empresa of categoriaDetalle.empresas">
      <div class="card" style="border-radius:12px">
        <section class="card-img">
          <img src="../assets/{{empresa.imagen}}" class="img-fluid" style="border-radius: 12px" />
          <h3 style="color: #fff; font-weight:bolder;">{{empresa.nombreEmpresa}}</h3>
        </section>
        <section class="p-3">
          <div *ngFor="let producto of empresa.productos">
            <div class="row p-2">
              <div class="col-lg-7">
                <h4 style="color:#563D7C;">{{producto.nombreProducto}}</h4>
              </div>
              <div class="col-lg-5">
                <input type="button" class="btn btn-secondary" (click)="pedir(producto)" value="Pedir">
              </div>
            </div>
            <div class="row">
              <div class="col-lg-8">
                <p>{{producto.descripcion}}</p>
              </div>
              <div class="col-lg-4 ml-auto">
                <b>$ {{producto.precio}}</b>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('Cerrar')">Cerrar</button>
  </div>
</ng-template>

<!-- Modal -->
<ng-template #modalUser let-modal>
  <div class="modal-header" style="background-color: #563D7C;">
    <h2 class="modal-title font-weight-bolder text-white">{{usuarioActual.nombre}} , Estas Son Tus Ordenes.</h2>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div id="zona-productos" class="card p-3" style="border-radius: 12px;">
      <div *ngFor="let orden of usuarioActual.ordenes">
        <h3 style="color: #563D7C; font-weight: bold;">{{orden.nombreProducto}}</h3>
        <p style="font-size: 18px;">
          {{orden.descripcion}}
        </p>
        <p class="float-right">
          <b style="font-size: 25px">${{orden.precio}}</b>
        </p>
        <hr style="clear: right;">
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('Cerrar')">Cerrar</button>
  </div>
</ng-template>
